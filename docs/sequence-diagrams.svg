<svg viewBox="0 0 1400 1600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 22px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .actor-box { fill: #ecf0f1; stroke: #34495e; stroke-width: 2; }
      .lifeline { stroke: #95a5a6; stroke-width: 2; stroke-dasharray: 5,5; }
      .activation { fill: #3498db; opacity: 0.3; stroke: #2980b9; stroke-width: 1; }
      .arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .return-arrow { stroke: #27ae60; stroke-width: 2; fill: none; stroke-dasharray: 5,5; marker-end: url(#return-arrowhead); }
      .arrow-label { font-family: Arial, sans-serif; font-size: 11px; fill: #2c3e50; }
      .note { fill: #fff9e6; stroke: #f39c12; stroke-width: 1.5; }
      .note-text { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      .step-num { font-family: Arial, sans-serif; font-size: 11px; font-weight: bold; fill: #e74c3c; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e" />
    </marker>
    <marker id="return-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" class="title">HR Event Publisher - Sequence Diagrams</text>

  <!-- ==================== FLOW 1: EMPLOYEE ONBOARDING ==================== -->
  <text x="700" y="65" text-anchor="middle" class="subtitle">Flow 1: Employee Onboarding (CDC-Driven)</text>

  <!-- Actors -->
  <rect x="80" y="85" width="100" height="40" class="actor-box" rx="5"/>
  <text x="130" y="110" text-anchor="middle" class="arrow-label" font-weight="bold">HR Admin</text>

  <rect x="250" y="85" width="100" height="40" class="actor-box" rx="5"/>
  <text x="300" y="110" text-anchor="middle" class="arrow-label" font-weight="bold">MariaDB</text>

  <rect x="420" y="85" width="100" height="40" class="actor-box" rx="5"/>
  <text x="470" y="110" text-anchor="middle" class="arrow-label" font-weight="bold">Debezium</text>

  <rect x="590" y="85" width="100" height="40" class="actor-box" rx="5"/>
  <text x="640" y="110" text-anchor="middle" class="arrow-label" font-weight="bold">NATS</text>

  <rect x="760" y="85" width="120" height="40" class="actor-box" rx="5"/>
  <text x="820" y="103" text-anchor="middle" class="arrow-label" font-weight="bold">Spring Boot</text>
  <text x="820" y="117" text-anchor="middle" class="arrow-label" font-size="9">(Event Publisher)</text>

  <rect x="950" y="85" width="100" height="40" class="actor-box" rx="5"/>
  <text x="1000" y="110" text-anchor="middle" class="arrow-label" font-weight="bold">ClickHouse</text>

  <rect x="1120" y="85" width="100" height="40" class="actor-box" rx="5"/>
  <text x="1170" y="110" text-anchor="middle" class="arrow-label" font-weight="bold">Consumers</text>

  <!-- Lifelines -->
  <line x1="130" y1="125" x2="130" y2="620" class="lifeline"/>
  <line x1="300" y1="125" x2="300" y2="620" class="lifeline"/>
  <line x1="470" y1="125" x2="470" y2="620" class="lifeline"/>
  <line x1="640" y1="125" x2="640" y2="620" class="lifeline"/>
  <line x1="820" y1="125" x2="820" y2="620" class="lifeline"/>
  <line x1="1000" y1="125" x2="1000" y2="620" class="lifeline"/>
  <line x1="1170" y1="125" x2="1170" y2="620" class="lifeline"/>

  <!-- Interactions -->
  <!-- 1. HR Admin -> MariaDB -->
  <text x="125" y="160" class="step-num">1</text>
  <path d="M 130 165 L 295 165" class="arrow"/>
  <text x="210" y="160" text-anchor="middle" class="arrow-label">INSERT employee</text>
  <rect x="290" y="170" width="20" height="60" class="activation"/>

  <!-- 2. Debezium reads binlog -->
  <text x="295" y="200" class="step-num">2</text>
  <path d="M 300 205 L 465 205" class="arrow"/>
  <text x="380" y="200" text-anchor="middle" class="arrow-label">Read binlog</text>
  <rect x="460" y="210" width="20" height="120" class="activation"/>

  <!-- 3. Debezium -> NATS -->
  <text x="465" y="250" class="step-num">3</text>
  <path d="M 470 255 L 635 255" class="arrow"/>
  <text x="530" y="245" text-anchor="middle" class="arrow-label">Publish CDC event</text>
  <text x="530" y="268" text-anchor="middle" class="note-text">cdc.hr.employees</text>
  <rect x="630" y="260" width="20" height="50" class="activation"/>

  <!-- 4. Spring Boot subscribes -->
  <text x="635" y="295" class="step-num">4</text>
  <path d="M 640 300 L 815 300" class="arrow"/>
  <text x="720" y="295" text-anchor="middle" class="arrow-label">Deliver CDC event</text>
  <rect x="810" y="305" width="20" height="200" class="activation"/>

  <!-- Note: Transformation -->
  <rect x="850" y="330" width="200" height="80" class="note" rx="3"/>
  <text x="950" y="348" text-anchor="middle" class="note-text" font-weight="bold">Business Logic:</text>
  <text x="950" y="363" text-anchor="middle" class="note-text">• Detect: INSERT = Hire</text>
  <text x="950" y="378" text-anchor="middle" class="note-text">• Enrich with context</text>
  <text x="950" y="393" text-anchor="middle" class="note-text">• Create EmployeeHired</text>

  <!-- 5. Query MariaDB for enrichment -->
  <text x="815" y="430" class="step-num">5</text>
  <path d="M 820 435 L 305 435" class="arrow"/>
  <text x="560" y="430" text-anchor="middle" class="arrow-label">Query dept/position names</text>
  <path d="M 300 445 L 815 445" class="return-arrow"/>

  <!-- 6. Store in ClickHouse -->
  <text x="825" y="475" class="step-num">6</text>
  <path d="M 820 480 L 995 480" class="arrow"/>
  <text x="900" y="475" text-anchor="middle" class="arrow-label">Store event</text>
  <rect x="990" y="485" width="20" height="30" class="activation"/>

  <!-- 7. Publish to NATS -->
  <text x="815" y="530" class="step-num">7</text>
  <path d="M 820 535 L 645 535" class="arrow"/>
  <text x="710" y="525" text-anchor="middle" class="arrow-label">Publish domain event</text>
  <text x="710" y="548" text-anchor="middle" class="note-text">events.hr.employee.hired</text>

  <!-- 8. Consumers receive -->
  <text x="645" y="580" class="step-num">8</text>
  <path d="M 640 585 L 1165 585" class="arrow"/>
  <text x="900" y="580" text-anchor="middle" class="arrow-label">Subscribe &amp; process</text>
  <rect x="1160" y="590" width="20" height="30" class="activation"/>

  <!-- ==================== FLOW 2: EXTERNAL TRANSFER EVENT ==================== -->
  <text x="700" y="690" text-anchor="middle" class="subtitle">Flow 2: Employee Transfer (External Event-Driven)</text>

  <!-- Actors -->
  <rect x="60" y="710" width="140" height="40" class="actor-box" rx="5"/>
  <text x="130" y="728" text-anchor="middle" class="arrow-label" font-weight="bold">Org Management</text>
  <text x="130" y="742" text-anchor="middle" class="arrow-label" font-size="9">System</text>

  <rect x="270" y="710" width="100" height="40" class="actor-box" rx="5"/>
  <text x="320" y="735" text-anchor="middle" class="arrow-label" font-weight="bold">NATS</text>

  <rect x="440" y="710" width="120" height="40" class="actor-box" rx="5"/>
  <text x="500" y="728" text-anchor="middle" class="arrow-label" font-weight="bold">Spring Boot</text>
  <text x="500" y="742" text-anchor="middle" class="arrow-label" font-size="9">(Event Publisher)</text>

  <rect x="630" y="710" width="100" height="40" class="actor-box" rx="5"/>
  <text x="680" y="735" text-anchor="middle" class="arrow-label" font-weight="bold">MariaDB</text>

  <rect x="800" y="710" width="100" height="40" class="actor-box" rx="5"/>
  <text x="850" y="735" text-anchor="middle" class="arrow-label" font-weight="bold">ClickHouse</text>

  <rect x="970" y="710" width="100" height="40" class="actor-box" rx="5"/>
  <text x="1020" y="735" text-anchor="middle" class="arrow-label" font-weight="bold">Consumers</text>

  <!-- Lifelines -->
  <line x1="130" y1="750" x2="130" y2="1200" class="lifeline"/>
  <line x1="320" y1="750" x2="320" y2="1200" class="lifeline"/>
  <line x1="500" y1="750" x2="500" y2="1200" class="lifeline"/>
  <line x1="680" y1="750" x2="680" y2="1200" class="lifeline"/>
  <line x1="850" y1="750" x2="850" y2="1200" class="lifeline"/>
  <line x1="1020" y1="750" x2="1020" y2="1200" class="lifeline"/>

  <!-- Interactions -->
  <!-- 1. Org System -> NATS -->
  <text x="125" y="790" class="step-num">1</text>
  <path d="M 130 795 L 315 795" class="arrow"/>
  <text x="210" y="785" text-anchor="middle" class="arrow-label">Publish dept change</text>
  <text x="210" y="808" text-anchor="middle" class="note-text">hr.external.org.transfer</text>
  <rect x="310" y="800" width="20" height="50" class="activation"/>

  <!-- Note: External Event -->
  <rect x="40" y="840" width="180" height="75" class="note" rx="3"/>
  <text x="130" y="858" text-anchor="middle" class="note-text" font-weight="bold">External Event:</text>
  <text x="130" y="873" text-anchor="middle" class="note-text">{employeeId: "emp-001",</text>
  <text x="130" y="888" text-anchor="middle" class="note-text">fromDept: "eng",</text>
  <text x="130" y="903" text-anchor="middle" class="note-text">toDept: "product"}</text>

  <!-- 2. NATS -> Spring Boot -->
  <text x="315" y="855" class="step-num">2</text>
  <path d="M 320 860 L 495 860" class="arrow"/>
  <text x="400" y="855" text-anchor="middle" class="arrow-label">Deliver transfer event</text>
  <rect x="490" y="865" width="20" height="300" class="activation"/>

  <!-- 3. Validate event -->
  <rect x="540" y="890" width="200" height="65" class="note" rx="3"/>
  <text x="640" y="908" text-anchor="middle" class="note-text" font-weight="bold">Validation:</text>
  <text x="640" y="923" text-anchor="middle" class="note-text">• Check event structure</text>
  <text x="640" y="938" text-anchor="middle" class="note-text">• Validate source system</text>

  <!-- 4. Query MariaDB for context -->
  <text x="505" y="980" class="step-num">3</text>
  <path d="M 500 985 L 675 985" class="arrow"/>
  <text x="580" y="975" text-anchor="middle" class="arrow-label">Query employee data</text>
  <text x="580" y="998" text-anchor="middle" class="note-text">(name, position, current dept)</text>
  <rect x="670" y="990" width="20" height="30" class="activation"/>
  <path d="M 680 1010 L 505 1010" class="return-arrow"/>
  <text x="590" y="1023" text-anchor="middle" class="arrow-label" style="fill: #27ae60;">Return context</text>

  <!-- 5. Business logic -->
  <rect x="540" y="1040" width="200" height="95" class="note" rx="3"/>
  <text x="640" y="1058" text-anchor="middle" class="note-text" font-weight="bold">Business Logic:</text>
  <text x="640" y="1073" text-anchor="middle" class="note-text">• Fetch dept names from IDs</text>
  <text x="640" y="1088" text-anchor="middle" class="note-text">• Determine transfer reason</text>
  <text x="640" y="1103" text-anchor="middle" class="note-text">• Calculate org distance</text>
  <text x="640" y="1118" text-anchor="middle" class="note-text">• Create EmployeeTransferred</text>

  <!-- 6. Store in ClickHouse -->
  <text x="505" y="1150" class="step-num">4</text>
  <path d="M 500 1155 L 845 1155" class="arrow"/>
  <text x="670" y="1150" text-anchor="middle" class="arrow-label">Store event</text>
  <rect x="840" y="1160" width="20" height="30" class="activation"/>

  <!-- 7. Publish to NATS -->
  <text x="495" y="1200" class="step-num">5</text>
  <path d="M 500 1205 L 325 1205" class="arrow"/>
  <text x="390" y="1195" text-anchor="middle" class="arrow-label">Publish domain event</text>
  <text x="390" y="1218" text-anchor="middle" class="note-text">events.hr.employee.transferred</text>

  <!-- 8. Consumers receive -->
  <text x="325" y="1255" class="step-num">6</text>
  <path d="M 320 1260 L 1015 1260" class="arrow"/>
  <text x="650" y="1255" text-anchor="middle" class="arrow-label">Subscribe &amp; process</text>
  <rect x="1010" y="1265" width="20" height="30" class="activation"/>

  <!-- Key Differences Box -->
  <rect x="80" y="1330" width="1240" height="240" style="fill: #f8f9fa; stroke: #7f8c8d; stroke-width: 2;" rx="8"/>
  <text x="700" y="1360" text-anchor="middle" class="subtitle">Key Differences</text>

  <!-- Two columns -->
  <line x1="700" y1="1375" x2="700" y2="1555" style="stroke: #bdc3c7; stroke-width: 1; stroke-dasharray: 3,3;"/>

  <!-- Left: Flow 1 -->
  <text x="120" y="1395" class="arrow-label" font-weight="bold" font-size="14" style="fill: #3498db;">Flow 1: CDC-Driven (Push)</text>
  
  <circle cx="130" cy="1420" r="4" fill="#3498db"/>
  <text x="145" y="1425" class="arrow-label">Source: Database binlog (MariaDB)</text>
  
  <circle cx="130" cy="1450" r="4" fill="#3498db"/>
  <text x="145" y="1455" class="arrow-label">Trigger: Direct data change (INSERT)</text>
  
  <circle cx="130" cy="1480" r="4" fill="#3498db"/>
  <text x="145" y="1485" class="arrow-label">Automatic capture, no coordination needed</text>
  
  <circle cx="130" cy="1510" r="4" fill="#3498db"/>
  <text x="145" y="1515" class="arrow-label">Simple transformation logic</text>
  
  <circle cx="130" cy="1540" r="4" fill="#3498db"/>
  <text x="145" y="1545" class="arrow-label">Output: EmployeeHired event</text>

  <!-- Right: Flow 2 -->
  <text x="740" y="1395" class="arrow-label" font-weight="bold" font-size="14" style="fill: #e67e22;">Flow 2: Event-Driven (Integration)</text>
  
  <circle cx="750" cy="1420" r="4" fill="#e67e22"/>
  <text x="765" y="1425" class="arrow-label">Source: External system (Org Management)</text>
  
  <circle cx="750" cy="1450" r="4" fill="#e67e22"/>
  <text x="765" y="1455" class="arrow-label">Trigger: Business action in external system</text>
  
  <circle cx="750" cy="1480" r="4" fill="#e67e22"/>
  <text x="765" y="1485" class="arrow-label">Requires external team to publish events</text>
  
  <circle cx="750" cy="1510" r="4" fill="#e67e22"/>
  <text x="765" y="1515" class="arrow-label">Complex transformation + context enrichment</text>
  
  <circle cx="750" cy="1540" r="4" fill="#e67e22"/>
  <text x="765" y="1545" class="arrow-label">Output: EmployeeTransferred event</text>

</svg>